{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Lysa Calendar</title>

	<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="{% static 'css/all.min.css' %}">
	<!-- <link rel="stylesheet" href="{% static 'custom.css' %}"> -->
	<link rel="stylesheet" href="{% static 'style.css' %}">



	<link rel="stylesheet" href="{% static 'full_calendar/main.css' %}">
	<style>
		.fc .fc-details-button {
			background-color: blue;
		}
		
		#app
		{
		background-color: #FFCBC3;
		}
		.fc .fc-view-harness .fc-view-harness-active{
			background-color: ;

		}


		.fc .fc-details-button {
			background-color: blue;
		}
		

		.fc .fc-timegrid-slot {
			height: 60px;
			border-bottom: 0 !important;
		}
		.fc .fc-view-harness fc-view-harness-active{
			background-color: antiquewhite;
		}
		.fc .fc-view-harness {
			background-color: #FBFBFB;
			width: 1200px;
			position: absolute;
			left: 150px;
			top: 150px;

		}

		.fc .fc-timegrid-slot {
			height: 60px;
			border-bottom: 0 !important;
		}
	</style>


</head>

<body>
	<div class="calendar-wd__section" id="app">
		<div class="calendar-wd">
			<div id='calendar'></div>
			<br>
			<br>
			<div class="calendar-wd__form calendar-wd__form-three">
				<div class="close-icon close-three" @click.prevent="onClose"><img src="{% static 'img/close.png' %}"
						alt=""></div>
				<div class="calendar-wd__form-three--one">
					<div class="calendar-wd__form-three-head">
						<ul class="list-group calendar-wd__form-three-list" id="list-tab" role="tablist">
							<li><a class="list-group-item" data-bs-toggle="list" href="#f-tab4" role="tab"><img
										src="{% static 'img/pen.png' %}" alt="#"></a></li>
							<li><a class="list-group-item active" data-bs-toggle="list" href="#f-tab3" role="tab"><img
										src="{% static 'img/message.png' %}" alt="#"></a></li>
							<li><a class="list-group-item" data-bs-toggle="list" href="#f-tab5" role="tab"><i
										class="icofont-bread"></i><img src="{% static 'img/bell-2.png' %}" alt="#"></a>
							</li>
						</ul>
						<img src="{% static 'img/calander-banner.png' %}">
					</div>
					<div class="calendar-wd__form-three-body">
						<div class="tab-content" id="nav-tabContent">
							<!-- Property Tab One -->
							<div class="tab-pane fade show active"  id="f-tab3" role="tabpanel">
								<div class="calendar-wd__form-separate-column">
									<div class="calendar-wd__form-three-one">
										<h2 class="calendar-wd__form-three-title">
											<span>[[calendar_name]]</span>[[event_title]]</h2>
										<div class="calendar-wd__form-body">
											<div class="calendar-wd__form-single">
												<h4 class="calendar-wd__form-heading"><i class="far fa-calendar-alt"></i>
													[[start_date]]　[[start_time]] - [[end_time]]</h4>
											</div>
											<div class="calendar-wd__form-single">
												<h4 class="calendar-wd__form-heading"><a href="#"><img
															src="{% static 'img/memo.png' %}"
															alt="#">[[event_location]]</a></h4>
												<div class="calendar-wd__form-list">
													[[description]]
												</div>
											</div>
										</div>
									</div>
									<div class="calendar-wd__form-three-two">
										<ul class="calendar-wd__form-list-img calendar-wd__form-list-two"
											v-for="attendee in attendees">
											<li><img src="{% static 'img/icon.png' %}" alt="#">[[attendee.event_attendee]]</li>

										</ul>
										<div class="calander-wd__button calander-wd__button-guest">
											<span class="plus-icon"><a href="#"><i class="fa fa-plus"></i></span>Add
											guests</a>
										</div>
									</div>
								</div>
							</div>
							<div class="tab-pane fade" id="f-tab4" role="tabpanel">
								<div class="calendar-wd__form-three--two">
									<div class="calendar-wd__form-1">
										<form class="form">
											<div class="form-group">
												<div class="input-group">
													<input id="datepick" type="text" placeholder="[Zoom]Toshiとの">
												</div>
											</div>
											<div class="form-group calendar-wd__date-pick">
												<div class="form-control wide" tabindex="0"><i
														class="fa fa-calendar"></i><span class="current"><input
															id="datepick" type="text"
															placeholder="Wednesday, 1 December"></span></div>
											</div>
											<div class="form-group">
												<div class="list-inner-group">
													<div class="list-single-group">
														<select class="form-select" aria-label="Default select example">
															<option selected="">15.30</option>
															<option value="1">15.30</option>
															<option value="2">15.30</option>
															<option value="3">15.30</option>
														</select>
													</div>
													<div class="list-single-group">
														<select class="form-select" aria-label="Default select example">
															<option selected="">16.30</option>
															<option value="1">16.30</option>
															<option value="2">16.30</option>
															<option value="3">16.30</option>
														</select>
													</div>
													<div class="list-single-group   project-dropdown">
														<select class="form-select" aria-label="Default select example">
															<option selected="">Don't repeat</option>
															<option value="1">Don't repeat</option>
															<option value="2">Don't repeat</option>
															<option value="3">Don't repeat</option>
														</select>
													</div>
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-icon"><i class="fa fa-map-marker"></i></span>
													<input id="datepick" type="text" placeholder="Add location">
												</div>
											</div>
											<div class="form-group project-dropdown">
												<select class="form-select" aria-label="Default select example">
													<option selected="">Project B</option>
													<option value="1">15.30</option>
													<option value="2">15.30</option>
													<option value="3">15.30</option>
												</select>
											</div>
											<div class="form-group select-man">
												<ul class="select-list-img">
													<li><a href="#"><img src="{% static 'img/icon.png' %}" alt="#"></a>
													</li>
													<li><a href="#"><img src="{% static 'img/icon-2.png' %}"
																alt="#"></a></li>
													<li><a href="#"><img src="{% static 'img/icon-3.png' %}"
																alt="#"></a></li>
													<li><span class="plus-icon"><i class="fa fa-plus"></i></span></li>
												</ul>
											</div>
											<div class="form-group">
												<ul class="calendar-wd__clist">
													<li><img src="{% static 'img/calender.png' %}">Email Participants
													</li>
													<li><img src="{% static 'img/memo.png' %}">Add Notes</li>
													<li><img src="{% static 'img/bell.png' %}">Set Reminder</li>
												</ul>
											</div>
											<div class="form-group button">
												<button type="submit" class="theme-btn theme-sec">More options</button>
												<b class="theme-btn theme-primary calendar-wd__submit">Save</b>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>

	<script src="{% static 'js/jquery.min.js' %}"></script>
	<script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>
	<script src="{% static 'js/all.min.js' %}"></script>

	<script src="{% static 'js/bootstrap.min.js' %}"></script>
	<script src="{% static '/full_calendar/main.js'%}"></script>
	<script src='https://cdn.jsdelivr.net/npm/moment@2.27.0/min/moment.min.js'></script>
	<script src='https://cdn.jsdelivr.net/npm/@fullcalendar/moment@5.5.0/main.global.min.js'></script>


	{% if debug %}
	<script src="{% static 'js/vue.js' %}"></script>
	{% else %}
	<script src="{% static 'js/vue.min.js' %}"></script>
	{% endif %}

	<script>
		var app = new Vue({
			el: '#app',
			delimiters: ['[[', ']]'],
			data: {
				weekly_events: [],
				popup: false,
				event_title: '',
				calendar_name: '',
				attendees: [],
				start_time: '',
				end_time: '',
				event_location: '',
				start_date: '',
				description:'',
				popup:false,
				flag:0,

			},
			mounted: function () {
				this.showEvents();
			},
			methods: {
				onClose: function () {
					console.log('test');
					$(".calendar-wd__form-three").toggleClass('active-event');
				},
				
				showEvents: function () {
					var that = this;
					$.ajax({
						method: 'GET',
						url: 'api/event-filter/' + 'weekly',
					}).then(response => {
						that.weekly_events = response.events;
						that.weeklyCalendar();
					})
				},

				weeklyCalendar: function () {
					var that = this;


					var calendarEl = document.getElementById('calendar');
					var calendar = new FullCalendar.Calendar(calendarEl, {

						headerToolbar: {
							left: 'prev, add_event, slot',
							center: 'title',
							right: 'setting, dayGridMonth,timeGridWeek,timeGridDay,listWeek, next'
						},
						themeSystem: 'bootstrap',
						customButtons: {
							add_event: {
								text: '+ Add Event',
							},
							slot: {
								text: 'Find Slot',
							},
							setting:{
								text:'setting',
								// bootstrapFontAwesome:'fas fa-cog',
							},

						},

						slotDuration: '00:30',
						default: 0,
						navLinks: true, // can click day/week names to navigate views
						nowIndicator: true,

						weekNumbers: true,

						
						// weekNumberCalculation: 'ISO',

						editable: true,
						// defaultView: 'week',
						selectable: true,
						dayMaxEvents: true,
						events: that.weekly_events,
						eventDidMount: function (info) {
							console.log(info);
							now = new Date()
							if (info.event.end < now) {
								console.log(info.event.backgroundColor);
								info.el.style.opacity = "0.5";
							}
							// {description: "Lecture", department: "BioChemistry"}
						},
						eventClick: function (event) {
							// $('.calendar-wd__form-three').show();
							$('.calendar-wd__form-three').toggleClass('active-event');
							that.flag = 1;
							// $('.calendar-wd__form-three').show();


							$('.calendar-wd__form-three').hover(function () {
								$('.calendar-wd__form-three').addClass('plus-bonus');
							});

							$(".calendar-wd__form-three").hover(
								function () {
									$(this).removeClass("hover-active");
								}, function () {
									$(this).addClass("hover-active");
								}
							);


							that.event_title = event.event._def.title;

							that.event_location = event.event._def.extendedProps.event_location;
							that.description = event.event._def.extendedProps.event_description;

							console.log(that.event_location);
							// that.start_time = new Date(event.event.start).toLocaleTimeString();
							// that.end_time = new Date(event.event.end).toLocaleTimeString();
							var st_date = new Date(event.event.start);
							date = st_date.getDate();
							year = st_date.getFullYear();
							month = st_date.toLocaleString('default', { month: 'short' });
							day = st_date.toLocaleString('en-us', {weekday:'short'});
							
							that.start_date = month + ' ' + date +',' + ' ' + year + ' ' + '('+ day + ')' ;
							console.log(that.start_date);
							var minute = ('0'+new Date(event.event.start).getMinutes()).slice(-2);
							var hour = new Date(event.event.start).getHours()
							
							var end_min = ('0'+new Date(event.event.end).getMinutes()).slice(-2);
							var end_hour = new Date(event.event.end).getHours()
							
							that.start_time = hour + "." + minute;
							that.end_time = end_hour + "." + end_min;

							that.calendar_name = event.event._def.extendedProps.calendar_name
							that.attendees = event.event._def.extendedProps.calendar_attendee


							calender_id = event.event._def.extendedProps.calender_id;

						},
						


					});
					calendar.render();

				}
			},
		})
		
		
	</script>


</body>

</html>