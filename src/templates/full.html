{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Lysa Calendar</title>

	<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
	<link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}">
	<link rel="stylesheet" href="{% static 'custom.css' %}">

	<link href='https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.css' rel='stylesheet' />
	<link href='https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.1/css/all.css' rel='stylesheet'>

	<link rel="stylesheet" href="{% static 'full_calendar/main.css' %}">
	<style>

		#calendar
		{
		}
		#app
		{
		background-color: antiquewhite;
		}
		.fc .fc-view-harness .fc-view-harness-active{
			background-color: antiquewhite;

		}


		.fc .fc-details-button {
			background-color: blue;
		}

		.fc .fc-timegrid-slot {
			height: 60px;
			border-bottom: 0 !important;
		}
		.fc .fc-view-harness fc-view-harness-active{
			background-color: antiquewhite;
		}
		.fc .fc-view-harness {
			background-color: yellowgreen;
			width: 1200px;
			position: absolute;
			left: 150px;
			top: 150px;

		}
	</style>


</head>

<body>
	<div class="calendar-wd__section" id="app">
		<div class="calendar-wd">
			<div id='calendar'></div>
			<br>
			<br>
			<div class="calendar-wd__form calendar-wd__form-three" style="display: none;" id="popup">
				<div class="close-icon close-three" @click.prevent="iconClose"><img src="{% static 'img/close.png' %}"
						alt=""></div>
				<div class="calendar-wd__form-three--one">
					<div class="calendar-wd__form-three-head">
						<ul class="list-group calendar-wd__form-three-list" id="list-tab" role="tablist">
							<li><a class="list-group-item" data-bs-toggle="list" href="#f-tab4" role="tab"><img
										src="{% static 'img/pen.png' %}" alt="#"></a></li>
							<li><a class="list-group-item active" data-bs-toggle="list" href="#f-tab3" role="tab"><img
										src="{% static 'img/message.png' %}" alt="#"></a></li>
							<li><a class="list-group-item" data-bs-toggle="list" href="#f-tab5" role="tab"><i
										class="icofont-bread"></i><img src="{% static 'img/bell-2.png' %}" alt="#"></a>
							</li>
						</ul>
						<img style="" src="{% static 'img/calander-banner.png' %}">

					</div>
					<div class="calendar-wd__form-three-body">
						<div class="tab-content" id="nav-tabContent">
							<div class="tab-pane fade show active" id="f-tab3" role="tabpanel">
								<div class="calendar-wd__form-separate-column">
									<div class="calendar-wd__form-three-one">
										<h2 class="calendar-wd__form-three-title">
											<span>[[calendar_name]]</span>[[event_title]]
										</h2>
										<div class="calendar-wd__form-body">
											<div class="calendar-wd__form-single">
												<h4 class="calendar-wd__form-heading"><img
														src="{% static 'img/calender.png' %}"
														alt="#"><span>[[start_time]]</span> <span
														class="ml-2">[[end_time]]</span> </h4>
											</div>
											<div class="calendar-wd__form-single">
												<h4 class="calendar-wd__form-heading"><a href="#"><img
															src="{% static 'img/memo.png' %}" alt="#">[[location]]</a>
												</h4>
												<ul class="calendar-wd__form-list">
													<li>Update sales presentation</li>
													<li>Book large meeting room</li>
													<li>Send material to Keiko Toyama</li>
												</ul>
											</div>
										</div>
									</div>
									<div class="calendar-wd__form-three-two">
										<ul v-for="attendee in attendees"
											class="calendar-wd__form-list-img calendar-wd__form-list-two">
											<li><img src="" alt="#">[[attendee.event_attendee]]</li>

										</ul>
										<div class="calander-wd__button calander-wd__button-guest">
											<span class="plus-icon"><a href="#"><i class="fa fa-plus"></i></span>Add
											guests</a>
										</div>
									</div>

								</div>
							</div>
						</div>

					</div>
				</div>


			</div>

		</div>
	</div>

	<script src="{% static 'js/jquery.min.js' %}"></script>
	<script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>

	<script src="{% static 'js/bootstrap.min.js' %}"></script>
	<script src="{% static '/full_calendar/main.js'%}"></script>
	<script src='https://cdn.jsdelivr.net/npm/moment@2.27.0/min/moment.min.js'></script>
	<script src='https://cdn.jsdelivr.net/npm/@fullcalendar/moment@5.5.0/main.global.min.js'></script>

	<link href='https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.css' rel='stylesheet' />
	<link href='https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.1/css/all.css' rel='stylesheet'>

	{% if debug %}
	<script src="{% static 'js/vue.js' %}"></script>
	{% else %}
	<script src="{% static 'js/vue.min.js' %}"></script>
	{% endif %}

	<link href='fullcalendar/main.css' rel='stylesheet' />
	<script src='fullcalendar/main.js'></script>

	<script>



		addButtons();



		function addButtons() {
			//create buttons
			var sample = $("<button/>")
				.addClass("fc-button fc-button-month fc-state-default fc-corner-left fc-state-active")
				.attr({
					unselectable: "on",
					type: "button"
				})
				.text("sample");
		};

		var app = new Vue({
			el: '#app',
			delimiters: ['[[', ']]'],
			data: {
				weekly_events: [],
				popup: false,
				event_title: '',
				calendar_name: '',
				attendees: [],
				start_time: '',
				end_time: '',
				location: '',


			},
			mounted: function () {
				this.showEvents();
			},
			methods: {
				iconClose: function () {
					$("#popup").hide();
				},

				showEvents: function () {
					var that = this;
					$.ajax({
						method: 'GET',
						url: 'api/event-filter/' + 'weekly',
					}).then(response => {
						that.weekly_events = response.events;
						that.weeklyCalendar();
						// for (let i = 0; i < that.weekly_events.length; i++) {
						// 	console.log(that.weekly_events[i].calendar_id)
						// 	console.log(color_keys[i]);
						// 	for (let j = 0; j < color_keys.length; j++) {
						// 		if (that.weekly_events[i].calendar_id == color_keys[j]) {
						// 			that.event_color = that.colors[color_keys[i]]
						// 			console.log(that.event_color);
						// 			

						// 		}
						// 	}

						// }
					})
				},

				weeklyCalendar: function () {
					var that = this;


					var calendarEl = document.getElementById('calendar');
					var calendar = new FullCalendar.Calendar(calendarEl, {

						dayHeaderContent: (args) => {
							return moment(args.date).format('ddd')
						},
						dayHeaderContent: (args) => {
							return moment(args.date).format('ddd D')
						},


						headerToolbar: {
							left: 'prev,today, ForwardButton',
							center: 'title',
							right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek, next'
						},
						customButtons: {
							ForwardButton: {
								bootstrapFontAwesome: 'fas fa-abacus',
				
								click: function () {

								}
							},
							BackwardButton: {
								//text: 'Bak√•t',
								click: function () {

								}
							},
							
						},

						//default: bootstrap,

						// initialDate: '2022-01-13',
						navLinks: true, // can click day/week names to navigate views
						nowIndicator: true,

						weekNumbers: true,
						// weekNumberCalculation: 'ISO',

						editable: true,
						defaultView: 'week',
						selectable: true,
						dayMaxEvents: true,
						events: that.weekly_events,
						eventDidMount: function (info) {
							console.log(info);
							now = new Date()
							if (info.event.end < now) {
								console.log('test')
								console.log(info.enevt)
								console.log(info.event.backgroundColor);
								info.el.style.opacity = "0.5";
							}
							// {description: "Lecture", department: "BioChemistry"}
						},
						// eventAfterAllRender: function (view) {
						// 	var e = $("#calendar").find('.fc-toolbar > div > h2') //.append("Number of open": "+openactivities+")
						// 	e.innerHTML = "hello";

						// 	document.body.appendChild(e);
						// },

						eventClick: function (event) {
							$('.calendar-wd__form-three').show();


							that.event_title = event.event._def.title;
							that.location = event.event._def.extendedProps.event_location;
							// that.start_time = new Date(event.event.start).toLocaleTimeString();
							// that.end_time = new Date(event.event.end).toLocaleTimeString();


							var minute = new Date(event.event.start).getMinutes()
							var hour = new Date(event.event.start).getHours()
							that.start_time = hour + "." + minute;
							var end_min = new Date(event.event.end).getMinutes()
							var end_hour = new Date(event.event.end).getHours()
							that.end_time = end_hour + "." + end_min;

							that.calendar_name = event.event._def.extendedProps.calendar_name
							that.attendees = event.event._def.extendedProps.calendar_attendee


							calender_id = event.event._def.extendedProps.calender_id;



						},

						views: {
							week: { // name of view
								titleFormat: { year: 'numeric', month: '2-digit', day: '2-digit' }
								// other view-specific options here
							}
						}
					});

					slotDuration: '00:30', // 2 hours


						calendar.render();

				}
			},
		})




	</script>




</body>

</html>